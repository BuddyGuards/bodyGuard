<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Food Diary</title>
    <style>
        .meal-box {
            width: 100px;
            height: 150px;
            border: 1px solid black;
            display: inline-block;
            position: relative;
            margin: 10px;
        }

        .add-btn {
            position: absolute;
            bottom: 5px;
            left: 5px;
            cursor: pointer;
        }

        .popup {
            display: none;
            position: absolute;
            top: 50px;
            left: 50px;
            background-color: #f0f0ff;
            border: 1px solid blue;
            padding: 10px;
            z-index: 10;
        }
    </style>
</head>
<body>

<!-- 아침, 점심, 저녁, 기타 박스 -->
<div>
    <div class="meal-box" data-type="아침">아침
        <button class="add-btn">+</button>
    </div>
    <div class="meal-box" data-type="점심">점심
        <button class="add-btn">+</button>
    </div>
    <div class="meal-box" data-type="저녁">저녁
        <button class="add-btn">+</button>
    </div>
    <div class="meal-box" data-type="기타">기타
        <button class="add-btn">+</button>
    </div>
</div>

<!-- 입력 팝업 창 -->
<div class="popup" id="inputPopup">
    <label>날짜 <input type="date" id="date"></label><br>
    <label>음식명 <input type="text" id="foodName"></label><br>
    <label>섭취량 <input type="text" id="amount"></label><br>
    <input type="hidden" id="type">

    <button id="saveBtn">저장하기</button>
</div>

<script>
    const popup = document.getElementById('inputPopup');
    const foodNameInput = document.getElementById('foodName');
    const amountInput = document.getElementById('amount');
    const dateInput = document.getElementById('date');
    const typeInput = document.getElementById('type');

    // 입력 필드 초기화 함수
    function clearInputs() {
        foodNameInput.value = '';
        amountInput.value = '';
        dateInput.value = '';
        typeInput.value = '';
    }

    // + 버튼 클릭 시 팝업 열기
    document.querySelectorAll('.add-btn').forEach(btn => {
        btn.addEventListener('click', function (evt) {
            evt.stopPropagation();

            const mealBox = this.closest('.meal-box');
            const mealType = mealBox.getAttribute('data-type');

            clearInputs(); // 이전 입력값 제거

            typeInput.value = mealType;

            popup.style.display = 'block';
            popup.style.top = mealBox.offsetTop + 30 + 'px';
            popup.style.left = mealBox.offsetLeft + 10 + 'px';
        });
    });

    // 저장 버튼 클릭 시
    document.getElementById('saveBtn').addEventListener('click', function (evt) {
        evt.stopPropagation();

        const requestData = {
            foodName: foodNameInput.value,
            amount: amountInput.value,
            date: dateInput.value,
            type: typeInput.value
        };

        fetch('/food/diary/add', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(requestData)
        })
            .then(response => response.text())
            .then(data => {
                if (data === 'success') {
                    alert('저장이 완료 되었습니다');
                    popup.style.display = 'none';
                    clearInputs(); // 저장 후 입력값 비움
                }
            });
    });

    // 팝업 외부 클릭 시 닫기
    document.addEventListener("click", function (evt) {
        // 팝업 내부 클릭 시
        if (popup.contains(evt.target)) {
            evt.stopPropagation();   // 팝업창 닫기 방지

        // 팝업 외부 클릭 시
        } else {
            popup.style.display = 'none';   // 팝업 숨기기
            clearInputs();   // 입력 값 초기화
        }
    });

</script>

</body>
</html>


