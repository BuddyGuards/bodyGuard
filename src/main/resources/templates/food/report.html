<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>영양 리포트 | BodyGuard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background-color: #f5f5f5;
      padding: 40px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 40px;
    }

    .chart-container {
      width: 500px;
      margin: auto;
    }

    table {
      margin: 40px auto;
      width: 80%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    th, td {
      padding: 12px 16px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    body.dark-mode {
      background-color: #121212;
      color: #f5f5f5;
    }

    /* 필요 시 메뉴, 카드 등도 다크 스타일 추가 */
    .dark-mode .profile-card {
      background-color: #1e1e1e;
      border-color: #333;
    }

    .dark-mode a {
      color: #cfcfcf;
    }

    .dark-mode .welcome-box {
      background-color: #2c2c2c;
      color: #ddd;
    }
  </style>
</head>
<body>
<button onclick="toggleDarkMode()">🌙 다크모드</button>
<h2 th:text="${date} + ' 영양 리포트'">2025-04-17 영양 리포트</h2>

<div class="chart-container">
  <canvas id="nutritionChart" width="400" height="400"></canvas>
</div>

<table>
  <caption style="caption-side: top; font-size: 1.2em; padding: 10px;">📊 영양소 일일 섭취 리포트</caption>
  <thead>
  <tr>
    <th>영양소</th>
    <th>실제 섭취량</th>
    <th>권장 섭취량</th>
    <th>달성률(%)</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="entry : ${actualEntries}">
    <td th:text="${{calories:'칼로리',carbs:'탄수화물',protein:'단백질',fat:'지방',sugar:'당류',sodium:'나트륨'}[entry.key]}">영양소명</td>
    <td th:text="${#numbers.formatDecimal(entry.value, 0, 'COMMA', 0, 'POINT')}">0</td>
    <td th:text="${#numbers.formatDecimal(recommended[entry.key], 0, 'COMMA', 0, 'POINT')}">0</td>
    <td th:text="${#numbers.formatDecimal(percent[entry.key], 1, 'COMMA', 0, 'POINT')} + '%'">0%</td>
  </tr>
  </tbody>
</table>

<script th:inline="javascript">
  const percentData = [[${percent}]];
  const labels = ['칼로리', '탄수화물', '단백질', '지방', '당류', '나트륨'];
  const keys = ['calories', 'carbs', 'protein', 'fat', 'sugar', 'sodium'];

  const chartData = keys.map(k => percentData[k]);

  const ctx = document.getElementById('nutritionChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [
        {
          label: '달성률 (%)',
          data: chartData,
          fill: true,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgb(75, 192, 192)',
          pointBackgroundColor: 'rgb(75, 192, 192)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 120,
          ticks: {
            stepSize: 20,
            callback: (value) => value + '%'
          }
        }
      },
      plugins: {
        legend: { position: 'top' },
        title: { display: false }
      }
    }
  });
</script>
<script>
  // 페이지가 열릴 때 localStorage에 저장된 다크모드 상태 확인
  window.onload = function () {
    const darkMode = localStorage.getItem("darkMode");
    if (darkMode === "true") {
      document.body.classList.add("dark-mode");
    }
  };

  // 다크모드 토글 함수
  function toggleDarkMode() {
    const isDark = document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", isDark); // 상태 저장
  }
</script>

</body>
</html>
