<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì˜ì–‘ ë¦¬í¬íŠ¸ | BodyGuard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background-color: #f5f5f5;
      padding: 40px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 40px;
    }

    .chart-container {
      width: 500px;
      margin: auto;
    }

    table {
      margin: 40px auto;
      width: 80%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    th, td {
      padding: 12px 16px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    body.dark-mode {
      background-color: #121212;
      color: #f5f5f5;
    }

    /* í•„ìš” ì‹œ ë©”ë‰´, ì¹´ë“œ ë“±ë„ ë‹¤í¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .dark-mode .profile-card {
      background-color: #1e1e1e;
      border-color: #333;
    }

    .dark-mode a {
      color: #cfcfcf;
    }

    .dark-mode .welcome-box {
      background-color: #2c2c2c;
      color: #ddd;
    }
  </style>
</head>
<body>
<button onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
<h2 th:text="${date} + ' ì˜ì–‘ ë¦¬í¬íŠ¸'">2025-04-17 ì˜ì–‘ ë¦¬í¬íŠ¸</h2>

<div class="chart-container">
  <canvas id="nutritionChart" width="400" height="400"></canvas>
</div>

<table>
  <caption style="caption-side: top; font-size: 1.2em; padding: 10px;">ğŸ“Š ì˜ì–‘ì†Œ ì¼ì¼ ì„­ì·¨ ë¦¬í¬íŠ¸</caption>
  <thead>
  <tr>
    <th>ì˜ì–‘ì†Œ</th>
    <th>ì‹¤ì œ ì„­ì·¨ëŸ‰</th>
    <th>ê¶Œì¥ ì„­ì·¨ëŸ‰</th>
    <th>ë‹¬ì„±ë¥ (%)</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="entry : ${actualEntries}">
    <td th:text="${{calories:'ì¹¼ë¡œë¦¬',carbs:'íƒ„ìˆ˜í™”ë¬¼',protein:'ë‹¨ë°±ì§ˆ',fat:'ì§€ë°©',sugar:'ë‹¹ë¥˜',sodium:'ë‚˜íŠ¸ë¥¨'}[entry.key]}">ì˜ì–‘ì†Œëª…</td>
    <td th:text="${#numbers.formatDecimal(entry.value, 0, 'COMMA', 0, 'POINT')}">0</td>
    <td th:text="${#numbers.formatDecimal(recommended[entry.key], 0, 'COMMA', 0, 'POINT')}">0</td>
    <td th:text="${#numbers.formatDecimal(percent[entry.key], 1, 'COMMA', 0, 'POINT')} + '%'">0%</td>
  </tr>
  </tbody>
</table>

<script th:inline="javascript">
  const percentData = [[${percent}]];
  const labels = ['ì¹¼ë¡œë¦¬', 'íƒ„ìˆ˜í™”ë¬¼', 'ë‹¨ë°±ì§ˆ', 'ì§€ë°©', 'ë‹¹ë¥˜', 'ë‚˜íŠ¸ë¥¨'];
  const keys = ['calories', 'carbs', 'protein', 'fat', 'sugar', 'sodium'];

  const chartData = keys.map(k => percentData[k]);

  const ctx = document.getElementById('nutritionChart').getContext('2d');
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'ë‹¬ì„±ë¥  (%)',
          data: chartData,
          fill: true,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgb(75, 192, 192)',
          pointBackgroundColor: 'rgb(75, 192, 192)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 120,
          ticks: {
            stepSize: 20,
            callback: (value) => value + '%'
          }
        }
      },
      plugins: {
        legend: { position: 'top' },
        title: { display: false }
      }
    }
  });
</script>
<script>
  // í˜ì´ì§€ê°€ ì—´ë¦´ ë•Œ localStorageì— ì €ì¥ëœ ë‹¤í¬ëª¨ë“œ ìƒíƒœ í™•ì¸
  window.onload = function () {
    const darkMode = localStorage.getItem("darkMode");
    if (darkMode === "true") {
      document.body.classList.add("dark-mode");
    }
  };

  // ë‹¤í¬ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
  function toggleDarkMode() {
    const isDark = document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", isDark); // ìƒíƒœ ì €ì¥
  }
</script>

</body>
</html>
